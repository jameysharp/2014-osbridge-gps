<!DOCTYPE html>
<html>
<head>
<title>GPS from 20,000km</title>

<link rel="stylesheet" href="jquery-jvectormap-1.2.2.css" />
<script src="satellite.js"></script>
<script src="jquery-1.11.1.min.js"></script>
<script src="jquery-jvectormap-1.2.2.min.js"></script>
<script src="jquery-jvectormap-world-mill-en.js"></script>

<!-- GPS TLEs from http://www.celestrak.com/NORAD/elements/ -->
<script type="x-text/x-tle" id="gps-tle">
GPS BIIA-10 (PRN 32)
1 20959U 90103A   14150.42270321  .00000022  00000-0  00000+0 0  3829
2 20959  54.3021 209.7611 0114363 349.9230   9.9380  2.00557092172173
GPS BIIA-14 (PRN 26)
1 22014U 92039A   14151.28697096 -.00000046  00000-0  00000+0 0  1634
2 22014  55.8609 270.4808 0211262  73.3381 328.2650  2.00561607153914
GPS BIIA-23 (PRN 04)
1 22877U 93068A   14151.23585253  .00000026  00000-0  00000+0 0  7666
2 22877  53.7753 144.3764 0103831  62.3950 107.8781  2.00555214150909
GPS BIIA-25 (PRN 03)
1 23833U 96019A   14150.73843188 -.00000049  00000-0  10000-3 0  9344
2 23833  53.7690  76.1786 0168062  79.4226 282.4446  2.00549438133180
GPS BIIA-26 (PRN 10)
1 23953U 96041A   14151.18049760  .00000019  00000-0  00000+0 0  4218
2 23953  53.9763 205.6286 0133888  48.7983  23.5959  2.00555938130976
GPS BIIR-2  (PRN 13)
1 24876U 97035A   14151.09654884 -.00000047  00000-0  00000+0 0  8762
2 24876  56.0108 270.9904 0051923 131.9639 234.1283  2.00574764123512
GPS BIIA-28 (PRN 08)
1 25030U 97067A   14151.14560419 -.00000083  00000-0  00000+0 0  8418
2 25030  57.1108 331.9408 0138471 201.8245 109.9528  2.00601725121403
GPS BIIR-3  (PRN 11)
1 25933U 99055A   14150.84056484  .00000003  00000-0  10000-3 0  3058
2 25933  51.0322 126.5997 0147361  73.7147 287.8652  2.00559310107323
GPS BIIR-4  (PRN 20)
1 26360U 00025A   14151.42572774  .00000020  00000-0  00000+0 0  4125
2 26360  53.1039 201.2825 0055309  75.5272 260.5106  2.00550369103026
GPS BIIR-5  (PRN 28)
1 26407U 00040A   14151.23478066 -.00000079  00000-0  00000+0 0  3542
2 26407  56.5352  28.5360 0193430 261.8213  48.9867  2.00564282101692
GPS BIIR-6  (PRN 14)
1 26605U 00071A   14151.47846373 -.00000045  00000-0  00000+0 0  3635
2 26605  55.5840 269.1485 0077948 245.9337 172.0983  2.00564336 99299
GPS BIIR-7  (PRN 18)
1 26690U 01004A   14151.44379046  .00000017  00000-0  00000+0 0  2515
2 26690  53.0462 204.3226 0155404 243.7512 242.8236  2.00560091 97698
GPS BIIR-8  (PRN 16)
1 27663U 03005A   14151.34530597 -.00000079  00000-0  00000+0 0  6869
2 27663  56.6196  28.2005 0076852  10.4473 136.3458  2.00572575 83052
GPS BIIR-9  (PRN 21)
1 27704U 03010A   14151.29712176  .00000026  00000-0  00000+0 0  5624
2 27704  53.4272 144.4474 0217174 244.3595 192.0774  2.00554576 81853
GPS BIIR-10 (PRN 22)
1 28129U 03058A   14151.31054539  .00000018  00000-0  00000+0 0  1383
2 28129  52.9189 204.4359 0074694 242.9180 114.2044  2.00557084 76551
GPS BIIR-11 (PRN 19)
1 28190U 04009A   14151.08013236 -.00000028  00000-0  00000+0 0  1428
2 28190  55.3406  90.2429 0103034  23.9372 205.4979  2.00569903 74739
GPS BIIR-12 (PRN 23)
1 28361U 04023A   14150.41144569 -.00000046  00000-0  00000+0 0  9534
2 28361  54.5334 265.4447 0095134 201.8327  61.0945  2.00551347 72790
GPS BIIR-13 (PRN 02)
1 28474U 04045A   14151.22496567  .00000026  00000-0  00000+0 0  8481
2 28474  53.8317 143.4594 0137214 221.9888 266.5054  2.00569768 70176
GPS BIIRM-1 (PRN 17)
1 28874U 05038A   14150.76021610 -.00000034  00000-0  00000+0 0   931
2 28874  55.5052  87.3451 0095043 240.3771  17.9029  2.00572228 63573
GPS BIIRM-2 (PRN 31)
1 29486U 06042A   14150.47832541 -.00000087  00000-0  00000+0 0  5032
2 29486  56.0601 326.6198 0080982 322.2402  11.7738  2.00577239 56278
GPS BIIRM-3 (PRN 12)
1 29601U 06052A   14151.36321823 -.00000080  00000-0  00000+0 0  3207
2 29601  56.5853  27.1369 0050392  23.2120 271.9248  2.00571394 55205
GPS BIIRM-4 (PRN 15)
1 32260U 07047A   14151.25679432 -.00000042  00000-0  00000+0 0  2350
2 32260  53.6689 262.7328 0062212  13.5624 339.6192  2.00560023 48593
GPS BIIRM-5 (PRN 29)
1 32384U 07062A   14151.32957933 -.00000029  00000-0  00000+0 0  2666
2 32384  55.5479  87.8418 0017057 306.1649 230.9787  2.00561167 47322
GPS BIIRM-6 (PRN 07)
1 32711U 08012A   14150.67981197 -.00000086  00000-0  10000-3 0   174
2 32711  55.7762 326.2582 0073968 199.2093 160.5045  2.00568776 45520
GPS BIIRM-8 (PRN 05)
1 35752U 09043A   14151.22682990  .00000021  00000-0  00000+0 0  7820
2 35752  54.2744 204.6387 0035260  13.4962  48.2068  2.00570989 35108
GPS BIIF-1  (PRN 25)
1 36585U 10022A   14151.20981389 -.00000082  00000-0  00000+0 0  5901
2 36585  55.9383  24.7094 0034965  36.6123 117.7220  2.00572503 29359
GPS BIIF-2  (PRN 01)
1 37753U 11036A   14150.22163801  .00000027  00000-0  00000+0 0   551
2 37753  55.0609 145.1996 0030551  13.5094 231.9069  2.00562961 21018
GPS BIIF-3  (PRN 24)
1 38833U 12053A   14150.86221373 -.00000087  00000-0  00000+0 0  6126
2 38833  54.8237 324.2625 0020171  13.7733 346.2720  2.00557399 12091
GPS BIIF-4  (PRN 27)
1 39166U 13023A   14151.21713854 -.00000034  00000-0  10000-3 0  3803
2 39166  55.2057  84.7149 0011941 356.4061   3.5629  2.00563636  7626
GPS BIIF-5  (PRN 30)
1 39533U 14008A   14151.21594600 -.00000087  00000-0  00000+0 0  1228
2 39533  54.9496 329.3546 0006117 173.2874 186.7225  2.00560482  1998
GPS BIIF-6  (PRN 06)
1 39741U 14026A   14147.41376904  .00000049  00000-0  00000+0 0    70
2 39741  55.0467 144.8044 0003124 180.7521 179.2623  1.97379015   206
</script>

<style>
#sat-map {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
}
</style>

</head>
<body>

<div id="sat-map"></div>

<script>
$(function() {
    function get_satrecs(tle_string) {
        var satrecs = [],
            lines = tle_string.trim().split("\n");
        for(var i = 2; i < lines.length; i += 3) {
            var label = lines[i - 2],
                line1 = lines[i - 1],
                line2 = lines[i];
            satrecs[label] = satellite.twoline2satrec(line1, line2);
        }
        return satrecs;
    }

    function mag(v) {
        return Math.sqrt(v.x * v.x + v.y * v.y + v.z * v.z);
    }

    function ignore(e) { e.preventDefault(); }

    $("#sat-map").vectorMap({
        map: 'world_mill_en',
        markerStyle: {
            initial: {
                fill: '#F8E23B',
                stroke: '#383f47'
            }
        },
        onRegionLabelShow: ignore,
        onRegionOver: ignore,
    });

    var map = $("#sat-map").vectorMap('get', 'mapObject'),
        satrecs = get_satrecs($("#gps-tle").text());

    function update() {
        var now = new Date(),
            gmst = satellite.gstime_from_date(
                now.getUTCFullYear(),
                now.getUTCMonth() + 1,
                now.getUTCDate(),
                now.getUTCHours(),
                now.getUTCMinutes(),
                now.getUTCSeconds()
            );

        map.removeAllMarkers();
        for(var label in satrecs)
            if(satrecs.hasOwnProperty(label)) {
                var posvel = satellite.propagate(
                        satrecs[label],
                        now.getUTCFullYear(),
                        now.getUTCMonth() + 1,
                        now.getUTCDate(),
                        now.getUTCHours(),
                        now.getUTCMinutes(),
                        now.getUTCSeconds()
                    ),
                    position = satellite.eci_to_geodetic(posvel.position, gmst),
                    speed = mag(posvel.velocity);

                map.addMarker(label, {
                    latLng: [position.latitude * 180 / Math.PI, position.longitude * 180 / Math.PI],
                    name: label + ": altitude " + Math.round(position.height) + "km, speed " + Math.round(speed * 3600) + "kph",
                });
            }
    }

    update();
    setInterval(update, 5000);
});
</script>

</body>
</html>
